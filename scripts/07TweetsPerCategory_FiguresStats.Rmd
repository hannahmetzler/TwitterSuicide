---
title: "Tweets per Category"
author: "Hannah Metzler"
date: "3/16/2021"
output: 
  pdf_document:
    df_print: kable
    keep_tex: true
url_colour: blue
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, results=T)
Sys.setlocale("LC_ALL", 'en_US.UTF-8')
options(scipen=99)
library(dplyr)
library(ggplot2)
library(viridis)
#load data (origin: scripts folder, where this .Rmd file is)
load("../tweets_other_datasets/Suicide_tweets_daily_volume_per_maincategory.R")
#our source script (but this takes a couple of minutes)
# source('06BuildPredictionsTimelineDataset.R')

#assign colours to categories: 
catcols = viridis(6)
colawareness = catcols[1]
colcoping = catcols[2]
colirrelevant = catcols[3]
colprevention = catcols[4]
colsuicidality = catcols[5]
colwerther = catcols[6]

#delete the month year variable (does not function properly)
dcatperday$monthyear=NULL
```

# Total number of tweets per category by year

* Irrelevant increase over the years may simply reflect increase in tweets overall. Irrelevant includes tweets about suicide not belonging in any other category, and off-topic tweet (metaphors, jokes, euthansia, bombings,...). 
* increasing awareness efforts especially in 2019?
* increasing awareness and prevention efforts over the years

```{r}
dcatperyear = dcatperday %>% 
  group_by(year, predictions) %>% 
  summarise(ntweets = sum(ntweets)) %>% 
  #2020 is not a full year 
  filter(year!="2020") %>% 
  #million tweets
  mutate(thousand_tweets = ntweets/1000)

dtotperyear = dcatperday %>%
  group_by(date) %>% #only first line of 6 categories (ntotal is the same on each line)
  slice(1) %>% 
  select(-predictions) %>% 
  group_by(year) %>% 
  summarise(ntotal = sum(ntotal)) %>% 
  #2020 is not a full year 
  filter(year!="2020") %>% 
  #million tweets
  mutate(thousand_tweets = ntotal/1000)

#plot per year
ggplot(data=dcatperyear, aes(x=year, y=thousand_tweets))+
  geom_point(aes(colour = predictions))+ geom_line(aes(colour = predictions))+
  #show total tweets with suicide terms per year (sum of all categories)
  # geom_line(data=dtotperyear, aes(x=year, y=ntotal))+
  theme_bw()+
  viridis::scale_colour_viridis(discrete=T)+
  scale_x_continuous(n.breaks=7)
```

 
 
```{r}
#plot per year
ggplot(data=filter(dcatperyear, predictions!="irrelevant"), aes(x=year, y=million_tweets, colour = predictions))+
  geom_point()+ geom_line()+
  theme_bw()+
  viridis::scale_colour_viridis(discrete=T)+
  scale_x_continuous(n.breaks=7)+
  ggtitle(" Same plot without the category Irrelevant")
  
```

* also shows the general increase for Werther tweets. 
* the increase exists since 2017, but is much smaller, for coping and suicidality tweets


# Total number of tweets per month (averaged across 7 years): stable pattern across months?

```{r}
dcatpermonth = dcatperday %>% 
  filter(date < as.Date("2020-04-01")) %>% #no full month of data
  group_by(month, predictions) %>% 
  summarise(ntweets = sum(ntweets)) %>% 
  #thousand tweets
  mutate(thousand_tweets = ntweets/1000) %>% ungroup()
#plot per month
ggplot(data=dcatpermonth, aes(x=month, y=thousand_tweets, colour = predictions))+
  geom_point()+ geom_line(aes(group=predictions))+
  theme_bw()+
  viridis::scale_colour_viridis(discrete=T)

```

* Open question: Are the peaks in certain categories driven by outlier months in some years, or general patterns?
    - September: world suicide prevention day is likely a general pattern
    - Werther probably influenced by celebrity suicides in July, November, December in one or some of the years.
    - Could celebrity suicides also explain the high peak of awareness in June?

# Total number of tweets per month across years (until March 2020)

```{r}
#monthly timeseries
dtsmonthly = dcatperday %>% 
  #filter(date < as.Date("2020-04-01")) %>% #no full month of data
  group_by(year, month, predictions) %>% 
  summarise(ntweets = sum(ntweets)) %>% 
  #thousand tweets
  mutate(thousand_tweets = ntweets/1000) %>% ungroup() %>% 
#add median per month 
  group_by(month, predictions) %>% 
  mutate(ntweets_mean = median(ntweets))

#plot per month
ggplot(data=dtsmonthly)+
  geom_point(aes(x=month, y=ntweets, colour = predictions))+ 
  geom_line(aes(x=month, y=ntweets_mean, group=predictions, colour=predictions))+
  theme_bw()+
  viridis::scale_colour_viridis(discrete=T)+
  ggtitle("One dot per year, median as a line")
```

* This shows that the peaks of awareness in June, Werther in July, Nov, Dec were driven by one single year (likely celebrity deaths).
* The suicidality peak in August is also driven by one single year. 

More detailed picture (without irrelevant category):

```{r}
ggplot(data=filter(dtsmonthly, predictions!="irrelevant"))+
  geom_point(aes(x=month, y=ntweets, colour = predictions))+ 
  geom_line(aes(x=month, y=ntweets_mean, group=predictions, colour=predictions))+
  theme_bw()+
  viridis::scale_colour_viridis(discrete=T)+
  ggtitle("One dot per year, median as a line (without irrelevant)")
```


* Werther July  peak seems driven by 2 events
* Werther November  peak seems driven by 2 events
* Werther December  peak seems driven by 1 event


```{r}
ggplot(data=filter(dtsmonthly, predictions!="irrelevant"))+
  geom_point(aes(x=month, y=ntweets, colour = predictions))+ 
  geom_line(aes(x=month, y=ntweets_mean, group=predictions, colour=predictions))+
  theme_bw()+
  viridis::scale_colour_viridis(discrete=T)+
  ylim(c(0,12000))+
  ggtitle("One dot per year, mean as a line, below 10.000 monthly tweets")

ggplot(data=filter(dtsmonthly, predictions!="irrelevant"))+
  # geom_violin(aes(x=month, y=ntweets, colour = predictions))+ 
  geom_point(aes(x=month, y=ntweets, colour = predictions))+ 
  geom_line(aes(x=month, y=ntweets_mean, group=predictions, colour=predictions))+
  facet_wrap(~predictions)+
  theme_bw()+
  viridis::scale_colour_viridis(discrete=T)+
  ylim(c(0,16000))+
  theme(axis.text.x=element_text(angle=60, hjust=1), axis.title.x=element_blank(), legend.position="none")+
  ggtitle("One dot per year, mean as a line, below 16.000 monthly tweets")
```

* This shows that the coping peak in May is one outlier only. 
* September prevention is systematically higher (world suicide prevention day)

# Entire timeline of daily tweets per category

```{r}
#plot per year
ggplot(data=dcatperday, aes(x=date, y=ntweets, colour = predictions))+
  geom_line()+
  theme_bw()+
  viridis::scale_colour_viridis(discrete=T)
```

```{r, coping suicidality daily}
ggplot(data=filter(dcatperday, predictions=="coping" | predictions=="suicidality"), 
                   aes(x=date, y=ntweets, colour = predictions))+
    geom_line()+ facet_wrap(~predictions, ncol=1)+
  theme_bw()+theme(legend.position="none")+
  scale_colour_manual(values=c(colcoping, colsuicidality))+
  ggtitle("Only coping and suicidality")

ggplot(data=filter(dcatperday, predictions=="coping" | predictions=="suicidality"), 
                   aes(x=date, y=ntweets, colour = predictions))+
    geom_line()+ facet_wrap(~predictions, ncol=1)+
  theme_bw()+theme(legend.position="none")+
  scale_colour_manual(values=c(colcoping, colsuicidality))+
  ylim(c(0,800))+
  ggtitle("Only coping and suicidality below 800 per day")
```

* 7 peaks above 700 daily tweets:
    - June 9 2018: likely linked to suicide of Anthony Bourdain on June 8th, and Kate Spade June 5th

```{r}
dcatperday %>% 
 filter(predictions=="coping" | predictions=="suicidality") %>% 
  filter(ntweets>700) %>% 
  select(predictions, date, ntweets) %>% 
  arrange(predictions)
```



## Awareness, Prevention, Werther

```{r}
ggplot(data=filter(dcatperday, predictions=="awareness" | predictions=="prevention"  | predictions=="werther"), 
                   aes(x=date, y=ntweets, colour = predictions))+
  geom_line()+ facet_wrap(~predictions, ncol=1)+
  theme_bw()+theme(legend.position="none")+
  scale_colour_manual(values=c(colawareness, colprevention, colwerther))
```


```{r}
ggplot(data=filter(dcatperday, predictions=="awareness" | predictions=="prevention"  | predictions=="werther"), 
                   aes(x=date, y=ntweets, colour = predictions))+
  geom_line()+ facet_wrap(~predictions, ncol=1)+
  theme_bw()+theme(legend.position="none")+
  ylim(c(0,10000))+
  scale_colour_manual(values=c(colawareness, colprevention, colwerther))+
  ggtitle("Daily tweets below 10000")
```


* 7 large awareness peaks above 1500 daily tweets:

```{r}
dcatperday %>% 
  filter(predictions=="awareness") %>% 
  filter(ntweets>1500) %>% 
  select(date, ntweets)
```

* 14 large prevention peaks from 2016 -2019, above 1500 daily tweets:
    - every year on September 10th
    - in 2019: before Christmas
    - other regular events to still identify: 2015-11-09, 2016-11-09 - a regular event?
    - other irregular events to stil lidentify: 2016-10-01, 2017-02-23, 2018-03-19, 2018-04-24	

```{r}
dcatperday %>% 
  filter(predictions=="prevention") %>% 
  filter(ntweets>1500) %>% 
  select(date, ntweets)
```


* Five  large Werther peaks from 2016 -2019, above 8000 daily tweets:

```{r}
dcatperday %>% 
  filter(predictions=="werther") %>% 
  filter(ntweets>8000) %>% 
  select(date, ntweets)
```

